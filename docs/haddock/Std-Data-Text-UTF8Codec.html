<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Std.Data.Text.UTF8Codec</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Std-Data-Text-UTF8Codec.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">stdio-0.1.0.0: Standard Input and Output for Haskell</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) Winterland 2017-2018</td></tr><tr><th>License</th><td>BSD</td></tr><tr><th>Maintainer</th><td>drkoster@qq.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>non-portable</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Std.Data.Text.UTF8Codec</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>UTF-8 codecs and helpers.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:encodeCharLength">encodeCharLength</a> :: Char -&gt; Int</li><li class="src short"><a href="#v:encodeChar">encodeChar</a> :: <a href="Std-Data-Array.html#t:MutablePrimArray">MutablePrimArray</a> s Word8 -&gt; Int -&gt; Char -&gt; ST s Int</li><li class="src short"><a href="#v:encodeChar-35-">encodeChar#</a> :: MutableByteArray# s -&gt; Int# -&gt; Char# -&gt; State# s -&gt; (#State# s, Int##)</li><li class="src short"><a href="#v:encodeCBytesChar">encodeCBytesChar</a> :: PrimMonad m =&gt; <a href="Std-Data-Array.html#t:MutablePrimArray">MutablePrimArray</a> (PrimState m) Word8 -&gt; Int -&gt; Char -&gt; m Int</li><li class="src short"><a href="#v:encodeCBytesChar-35-">encodeCBytesChar#</a> :: MutableByteArray# s -&gt; Int# -&gt; Char# -&gt; State# s -&gt; (#State# s, Int##)</li><li class="src short"><a href="#v:decodeChar">decodeChar</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; (#Char, Int#)</li><li class="src short"><a href="#v:decodeChar-35-">decodeChar#</a> :: ByteArray# -&gt; Int# -&gt; (#Char#, Int##)</li><li class="src short"><a href="#v:decodeCharLen">decodeCharLen</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; Int</li><li class="src short"><a href="#v:decodeCharLen-35-">decodeCharLen#</a> :: ByteArray# -&gt; Int# -&gt; Int#</li><li class="src short"><a href="#v:decodeCharReverse">decodeCharReverse</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; (#Char, Int#)</li><li class="src short"><a href="#v:decodeCharReverse-35-">decodeCharReverse#</a> :: ByteArray# -&gt; Int# -&gt; (#Char#, Int##)</li><li class="src short"><a href="#v:decodeCharLenReverse">decodeCharLenReverse</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; Int</li><li class="src short"><a href="#v:decodeCharLenReverse-35-">decodeCharLenReverse#</a> :: ByteArray# -&gt; Int# -&gt; Int#</li><li class="src short"><a href="#v:validateChar">validateChar</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; Int -&gt; Int</li><li class="src short"><a href="#v:validateChar-35-">validateChar#</a> :: ByteArray# -&gt; Int# -&gt; Int# -&gt; Int#</li><li class="src short"><a href="#v:between-35-">between#</a> :: Word# -&gt; Word# -&gt; Word# -&gt; Bool</li><li class="src short"><a href="#v:isContinueByte-35-">isContinueByte#</a> :: Word# -&gt; Bool</li><li class="src short"><a href="#v:chr1-35-">chr1#</a> :: Word# -&gt; Char#</li><li class="src short"><a href="#v:chr2-35-">chr2#</a> :: Word# -&gt; Word# -&gt; Char#</li><li class="src short"><a href="#v:chr3-35-">chr3#</a> :: Word# -&gt; Word# -&gt; Word# -&gt; Char#</li><li class="src short"><a href="#v:chr4-35-">chr4#</a> :: Word# -&gt; Word# -&gt; Word# -&gt; Word# -&gt; Char#</li><li class="src short"><a href="#v:copyChar">copyChar</a> :: Int -&gt; <a href="Std-Data-Array.html#t:MutablePrimArray">MutablePrimArray</a> s Word8 -&gt; Int -&gt; <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; ST s ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:encodeCharLength" class="def">encodeCharLength</a> :: Char -&gt; Int <a href="#v:encodeCharLength" class="selflink">#</a></p><div class="doc"><p>Return a codepoint's encoded length in bytes</p><p>If the codepoint is invalid, we return 3(encoded bytes length of replacement char <code>U+FFFD</code>).</p></div></div><div class="top"><p class="src"><a id="v:encodeChar" class="def">encodeChar</a> :: <a href="Std-Data-Array.html#t:MutablePrimArray">MutablePrimArray</a> s Word8 -&gt; Int -&gt; Char -&gt; ST s Int <a href="#v:encodeChar" class="selflink">#</a></p><div class="doc"><p>Encode a <code>Char</code> into bytes</p><p>Write <code>U+FFFD</code> (encoded as <code>EF BF BD</code> 3 bytes) for invalid unicode codepoint.
 This function assumed there're enough space for encoded bytes, and return the advanced index.</p></div></div><div class="top"><p class="src"><a id="v:encodeChar-35-" class="def">encodeChar#</a> :: MutableByteArray# s -&gt; Int# -&gt; Char# -&gt; State# s -&gt; (#State# s, Int##) <a href="#v:encodeChar-35-" class="selflink">#</a></p><div class="doc"><p>The unboxed version of <code><a href="Std-Data-Text-UTF8Codec.html#v:encodeChar">encodeChar</a></code></p><p>This function is marked as <code>NOINLINE</code> to reduce code size.</p></div></div><div class="top"><p class="src"><a id="v:encodeCBytesChar" class="def">encodeCBytesChar</a> :: PrimMonad m =&gt; <a href="Std-Data-Array.html#t:MutablePrimArray">MutablePrimArray</a> (PrimState m) Word8 -&gt; Int -&gt; Char -&gt; m Int <a href="#v:encodeCBytesChar" class="selflink">#</a></p><div class="doc"><p>Encode a <code>Char</code> into bytes with non-standard UTF-8 encoding(Used in <a href="Data-CBytes.html">Data.CBytes</a>).</p><p>'\NUL' is encoded as two bytes <code>C0 80</code> , '\xD800' ~ '\xDFFF' is encoded as a three bytes normal utf-8 codepoint.
 This function assumed there're enough space for encoded bytes, and return the advanced index.</p></div></div><div class="top"><p class="src"><a id="v:encodeCBytesChar-35-" class="def">encodeCBytesChar#</a> :: MutableByteArray# s -&gt; Int# -&gt; Char# -&gt; State# s -&gt; (#State# s, Int##) <a href="#v:encodeCBytesChar-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:decodeChar" class="def">decodeChar</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; (#Char, Int#) <a href="#v:decodeChar" class="selflink">#</a></p><div class="doc"><p>Decode a <code>Char</code> from bytes</p><p>This function assumed all bytes are UTF-8 encoded, and the index param point to the
 beginning of a codepoint, the decoded character and the advancing offset are returned.</p><p>It's annoying to use unboxed tuple here but we really want GHC to optimize it away.</p></div></div><div class="top"><p class="src"><a id="v:decodeChar-35-" class="def">decodeChar#</a> :: ByteArray# -&gt; Int# -&gt; (#Char#, Int##) <a href="#v:decodeChar-35-" class="selflink">#</a></p><div class="doc"><p>The unboxed version of <code><a href="Std-Data-Text-UTF8Codec.html#v:decodeChar">decodeChar</a></code></p><p>This function is marked as <code>NOINLINE</code> to reduce code size.</p></div></div><div class="top"><p class="src"><a id="v:decodeCharLen" class="def">decodeCharLen</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; Int <a href="#v:decodeCharLen" class="selflink">#</a></p><div class="doc"><p>Decode a codepoint's length in bytes</p><p>This function assumed all bytes are UTF-8 encoded, and the index param point to the
 beginning of a codepoint.</p></div></div><div class="top"><p class="src"><a id="v:decodeCharLen-35-" class="def">decodeCharLen#</a> :: ByteArray# -&gt; Int# -&gt; Int# <a href="#v:decodeCharLen-35-" class="selflink">#</a></p><div class="doc"><p>The unboxed version of <code><a href="Std-Data-Text-UTF8Codec.html#v:decodeCharLen">decodeCharLen</a></code></p><p>This function is marked as <code>NOINLINE</code> to reduce code size.</p></div></div><div class="top"><p class="src"><a id="v:decodeCharReverse" class="def">decodeCharReverse</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; (#Char, Int#) <a href="#v:decodeCharReverse" class="selflink">#</a></p><div class="doc"><p>Decode a <code>Char</code> from bytes in rerverse order.</p><p>This function assumed all bytes are UTF-8 encoded, and the index param point to the end
 of a codepoint, the decoded character and the backward advancing offset are returned.</p></div></div><div class="top"><p class="src"><a id="v:decodeCharReverse-35-" class="def">decodeCharReverse#</a> :: ByteArray# -&gt; Int# -&gt; (#Char#, Int##) <a href="#v:decodeCharReverse-35-" class="selflink">#</a></p><div class="doc"><p>The unboxed version of <code><a href="Std-Data-Text-UTF8Codec.html#v:decodeCharReverse">decodeCharReverse</a></code></p><p>This function is marked as <code>NOINLINE</code> to reduce code size.</p></div></div><div class="top"><p class="src"><a id="v:decodeCharLenReverse" class="def">decodeCharLenReverse</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; Int <a href="#v:decodeCharLenReverse" class="selflink">#</a></p><div class="doc"><p>Decode a codepoint's length in bytes in reverse order.</p><p>This function assumed all bytes are UTF-8 encoded, and the index param point to the end
 of a codepoint.</p></div></div><div class="top"><p class="src"><a id="v:decodeCharLenReverse-35-" class="def">decodeCharLenReverse#</a> :: ByteArray# -&gt; Int# -&gt; Int# <a href="#v:decodeCharLenReverse-35-" class="selflink">#</a></p><div class="doc"><p>The unboxed version of <code><a href="Std-Data-Text-UTF8Codec.html#v:decodeCharLenReverse">decodeCharLenReverse</a></code></p><p>This function is marked as <code>NOINLINE</code> to reduce code size.</p></div></div><div class="top"><p class="src"><a id="v:validateChar" class="def">validateChar</a> :: <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; Int -&gt; Int <a href="#v:validateChar" class="selflink">#</a></p><div class="doc"><p>Validate if current index point to a valid utf8 codepoint.</p><p>If the codepoint is valid, return the utf8 bytes length, otherwise return the negation of
 offset we should skip(so that a replacing decoder can meet the security rules).
 If <code>0#</code> is returned, then you should feed more bytes to continue validation. Note this function
 guarantee only return <code>0</code> when the trailing bytes are partial valid codepoint. That means you
 can safely replace them with a replacement char or ignore it if no more bytes are to be fed.</p><p>reference: <a href="https://howardhinnant.github.io/utf_summary.html">https://howardhinnant.github.io/utf_summary.html</a></p></div></div><div class="top"><p class="src"><a id="v:validateChar-35-" class="def">validateChar#</a> :: ByteArray# -&gt; Int# -&gt; Int# -&gt; Int# <a href="#v:validateChar-35-" class="selflink">#</a></p><div class="doc"><p>The unboxed version of <code><a href="Std-Data-Text-UTF8Codec.html#v:decodeCharLenReverse">decodeCharLenReverse</a></code></p><p>This function is marked as <code>NOINLINE</code> to reduce code size.</p></div></div><div class="top"><p class="src"><a id="v:between-35-" class="def">between#</a> :: Word# -&gt; Word# -&gt; Word# -&gt; Bool <a href="#v:between-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:isContinueByte-35-" class="def">isContinueByte#</a> :: Word# -&gt; Bool <a href="#v:isContinueByte-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:chr1-35-" class="def">chr1#</a> :: Word# -&gt; Char# <a href="#v:chr1-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:chr2-35-" class="def">chr2#</a> :: Word# -&gt; Word# -&gt; Char# <a href="#v:chr2-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:chr3-35-" class="def">chr3#</a> :: Word# -&gt; Word# -&gt; Word# -&gt; Char# <a href="#v:chr3-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:chr4-35-" class="def">chr4#</a> :: Word# -&gt; Word# -&gt; Word# -&gt; Word# -&gt; Char# <a href="#v:chr4-35-" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:copyChar" class="def">copyChar</a> :: Int -&gt; <a href="Std-Data-Array.html#t:MutablePrimArray">MutablePrimArray</a> s Word8 -&gt; Int -&gt; <a href="Std-Data-Array.html#t:PrimArray">PrimArray</a> Word8 -&gt; Int -&gt; ST s () <a href="#v:copyChar" class="selflink">#</a></p><div class="doc"><p>Unrolled copy loop for copying a utf8-encoded codepoint from source array to target array.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>