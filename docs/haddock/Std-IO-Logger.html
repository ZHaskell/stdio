<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Std.IO.Logger</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">stdio-0.1.0.0: Standard Input and Output for Haskell</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) Dong Han 2017-2018</td></tr><tr><th>License</th><td>BSD</td></tr><tr><th>Maintainer</th><td>winterland1989@gmail.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Portability</th><td>non-portable</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Std.IO.Logger</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">A simple Logger type</a></li><li><a href="#g:2">logging functions</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Simple, high performance logger. The design choice of this logger is biased towards simplicity instead of generlization:</p><ul><li>All log functions lives in <code><a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a></code> , customization via <code><a href="Std-IO-Logger.html#v:changeDefaultLogger" title="Std.IO.Logger">changeDefaultLogger</a></code> at the start of the program.</li><li>The log format is basically fixed with simple JSON support.</li><li>Each logging thread are responsible for building log <code>Builder</code>s into a small <code><a href="Std-Data-Vector-Base.html#t:Bytes" title="Std.Data.Vector.Base">Bytes</a></code> with line buffer
      instead of leaving all <code>Builder</code>s to the flushing thread:</li><li>We won't keep garbage for too long simply because they're referenced by log's <code>Builder</code>.</li><li>Each logging thread only need perform a CAS to prepend log <code><a href="Std-Data-Vector-Base.html#t:Bytes" title="Std.Data.Vector.Base">Bytes</a></code> into a list, which reduces contention.</li><li>Logging order is preserved under concurrent settings.</li></ul><p>Flushing is automatic and throttled for <code><a href="Std-IO-Logger.html#v:debug" title="Std.IO.Logger">debug</a></code>, <code><a href="Std-IO-Logger.html#v:info" title="Std.IO.Logger">info</a></code>, <code><a href="Std-IO-Logger.html#v:warn" title="Std.IO.Logger">warn</a></code> to boost performance, while a <code><a href="Std-IO-Logger.html#v:fatal" title="Std.IO.Logger">fatal</a></code> log always flush logger's buffer, This also lead to a problem that if main thread exits too early logs may missed, to add a flushing when program exits, use <code><a href="Std-IO-Logger.html#v:withLogger" title="Std.IO.Logger">withLogger</a></code> like:</p><p>@@@
import Std.IO.Logger</p><p>main :: IO ()
main = withLogger $ do
    ....
@@@</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Logger">Logger</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:LoggerConfig">LoggerConfig</a> = <a href="#v:LoggerConfig">LoggerConfig</a> {<ul class="subs"><li><a href="#v:loggerBufferSize">loggerBufferSize</a> :: !<a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:loggerMinFlushInterval">loggerMinFlushInterval</a> :: !<a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:loggerTsCache">loggerTsCache</a> :: <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> ())</li><li><a href="#v:loggerLineBufSize">loggerLineBufSize</a> :: !<a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li><a href="#v:loggerShowDebug">loggerShowDebug</a> :: <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li><li><a href="#v:loggerShowTS">loggerShowTS</a> :: <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li></ul>}</li><li class="src short"><a href="#v:newLogger">newLogger</a> :: <a href="Std-IO-Buffered.html#t:Output" title="Std.IO.Buffered">Output</a> o =&gt; <a href="Std-IO-Logger.html#t:LoggerConfig" title="Std.IO.Logger">LoggerConfig</a> -&gt; o -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Std-IO-Logger.html#t:Logger" title="Std.IO.Logger">Logger</a></li><li class="src short"><a href="#v:changeDefaultLogger">changeDefaultLogger</a> :: <a href="Std-IO-Logger.html#t:Logger" title="Std.IO.Logger">Logger</a> -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:withLogger">withLogger</a> :: <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:debug">debug</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:info">info</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:warn">warn</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:fatal">fatal</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:otherLevel">otherLevel</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> -&gt; <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>A simple Logger type</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Logger" class="def">Logger</a> <a href="#t:Logger" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LoggerConfig" class="def">LoggerConfig</a> <a href="#t:LoggerConfig" class="selflink">#</a></p><div class="doc"><p>Logger configuration.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LoggerConfig" class="def">LoggerConfig</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:loggerBufferSize" class="def">loggerBufferSize</a> :: !<a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc"><p>Buffer size used when creating logger's <code><a href="Std-IO-Buffered.html#t:BufferedOutput" title="Std.IO.Buffered">BufferedOutput</a></code></p></div></li><li><dfn class="src"><a id="v:loggerMinFlushInterval" class="def">loggerMinFlushInterval</a> :: !<a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc"><p>Minimal flush interval, see Notes on <code><a href="Std-IO-Logger.html#v:debug" title="Std.IO.Logger">debug</a></code></p></div></li><li><dfn class="src"><a id="v:loggerTsCache" class="def">loggerTsCache</a> :: <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> ())</dfn><div class="doc"><p>A IO action return a formatted date/time string</p></div></li><li><dfn class="src"><a id="v:loggerLineBufSize" class="def">loggerLineBufSize</a> :: !<a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></dfn><div class="doc"><p>Buffer size to build each log/line</p></div></li><li><dfn class="src"><a id="v:loggerShowDebug" class="def">loggerShowDebug</a> :: <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></dfn><div class="doc"><p>Set to <code><a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a></code> to filter debug logs</p></div></li><li><dfn class="src"><a id="v:loggerShowTS" class="def">loggerShowTS</a> :: <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></dfn><div class="doc"><p>Set to <code><a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a></code> to disable auto data/time string prepending</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:newLogger" class="def">newLogger</a> :: <a href="Std-IO-Buffered.html#t:Output" title="Std.IO.Buffered">Output</a> o =&gt; <a href="Std-IO-Logger.html#t:LoggerConfig" title="Std.IO.Logger">LoggerConfig</a> -&gt; o -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> <a href="Std-IO-Logger.html#t:Logger" title="Std.IO.Logger">Logger</a> <a href="#v:newLogger" class="selflink">#</a></p><div class="doc"><p>Make a new logger</p></div></div><div class="top"><p class="src"><a id="v:changeDefaultLogger" class="def">changeDefaultLogger</a> :: <a href="Std-IO-Logger.html#t:Logger" title="Std.IO.Logger">Logger</a> -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:changeDefaultLogger" class="selflink">#</a></p><div class="doc"><p>Change default logger.</p></div></div><div class="top"><p class="src"><a id="v:withLogger" class="def">withLogger</a> :: <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:withLogger" class="selflink">#</a></p><div class="doc"><p>Flush default logger when program exits.</p></div></div><a href="#g:2" id="g:2"><h1>logging functions</h1></a><div class="top"><p class="src"><a id="v:debug" class="def">debug</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:debug" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:info" class="def">info</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:info" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:warn" class="def">warn</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:warn" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:fatal" class="def">fatal</a> :: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> () -&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> () <a href="#v:fatal" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:otherLevel" class="def">otherLevel</a> <a href="#v:otherLevel" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> ()</td><td class="doc"><p>log level</p></td></tr><tr><td class="src">-&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></td><td class="doc"><p>flush immediately?</p></td></tr><tr><td class="src">-&gt; <a href="Std-Data-Builder-Base.html#t:Builder" title="Std.Data.Builder.Base">Builder</a> ()</td><td class="doc"><p>log content</p></td></tr><tr><td class="src">-&gt; <a href="file:///opt/ghc/8.6.1/share/doc/ghc-8.6.1/html/libraries/base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.20.0</p></div></body></html>